# 1.

When run `mem` program
`vmstat` analyze that there is 1 `runnable process`; `user time` also increase double

```
procs -----------memory---------- ---swap-- -----io---- -system-- -------cpu-------
 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st gu
 0  0      0 17187776 1261332 7257560    0    0     0     0 1264 1200  0  0 100  0  0  0
 0  0      0 17187332 1261332 7257560    0    0     0     0 1439 1377  0  0 100  0  0  0
 0  0      0 17186728 1261332 7257560    0    0     0     8 1654 1885  0  0 100  0  0  0
 0  0      0 17184724 1261360 7257560    0    0     0   224 2004 2185  0  0 99  0  0  0
 0  0      0 17186584 1261360 7257560    0    0     0     0 1541 1634  0  0 99  0  0  0
==                                                                     =
 1  0      0 17191792 1261360 7257560    0    0     0    40 2660 2080  2  0 97  0  0  0
 1  0      0 17191932 1261360 7257560    0    0     0     0 3780 1693  9  0 91  0  0  0
 1  0      0 17188656 1261360 7257560    0    0     0     4 3831 1860  9  0 91  0  0  0
 2  0      0 17172548 1261368 7257568    0    0     0   104 4744 3187 10  0 90  0  0  0
 1  0      0 17165812 1261368 7257560    0    0     0   152 4569 2471  9  0 91  0  0  0
 1  0      0 17179964 1261376 7260252    0    0     0    68 5289 3801  9  1 90  0  0  0
```

When run more than 1 `mem` instances

```
procs -----------memory---------- ---swap-- -----io---- -system-- -------cpu-------
 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st gu
 1  0      0 17191972 1261480 7257564    0    0     0   656 6507 5131  9  1 90  0  0  0
 1  0      0 17187184 1261480 7257564    0    0     0     0 4228 2084  9  0 91  0  0  0
==                                                                     =
 2  0      0 17188976 1261480 7257560    0    0     0     0 7264 6264 11  1 88  0  0  0
 2  0      0 17190888 1261492 7257612    0    0     0  1132 7381 2822 17  0 82  0  0  0
 3  0      0 17199188 1261492 7257496    0    0     0    32 6923 2264 17  0 83  0  0  0
 2  0      0 17195104 1261492 7257496    0    0     0     0 7089 2373 17  0 83  0  0  0
 2  0      0 17187408 1261500 7257500    0    0     0   152 7951 3248 17  1 82  0  0  0
==
 3  0      0 17189072 1261512 7257488    0    0     0   208 7764 2853 18  0 82  0  0  0
 3  0      0 17189180 1261512 7257500    0    0     0     8 9567 3325 25  0 74  0  0  0
 3  0      0 17186400 1261512 7257500    0    0     0    32 8936 2550 25  0 74  0  0  0
 3  0      0 17182368 1261512 7257500    0    0     0     0 8903 2678 25  0 75  0  0  0
 3  0      0 17160736 1261548 7260700    0    0     0   512 12045 6291 26  1 73  0  0  0
==
 4  0      0 17162100 1261548 7260644    0    0     0     0 10296 3838 28  0 72  0  0  0
 4  0      0 17161888 1261548 7257576    0    0     0     0 11168 3099 34  0 66  0  0  0
 4  0      0 17162596 1261548 7257508    0    0     0    48 10982 3243 34  0 66  0  0  0
 4  0      0 17166512 1261548 7257508    0    0     0     0 11460 3035 34  0 66  0  0  0
```

# 2.

```
procs -----------memory---------- ---swap-- -----io---- -system-- -------cpu-------
 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st gu
 4  0      0 17128844 1267464 7257980    0    0   202   123 1380    3  1  0 98  0  0  0
 0  0      0 17131684 1267464 7254844    0    0     0    26 1808 1698  0  0 100  0  0  0
 0  0      0 17142108 1267480 7254844    0    0     0   200 2462 2393  1  0 98  0  0  0
 0  0      0 17136816 1267496 7254844    0    0     0   122 1555 1608  0  0 100  0  0  0
 0  0      0 17133888 1267496 7254844    0    0     0     6 2319 2510  0  0 99  0  0  0
==
 1  0      0 16244440 1267508 7254836    0    0     0   512 3780 4223  1  2 97  0  0  0
 1  0      0 16066076 1267596 7254840    0    0     0   228 4117 2934  9  1 90  0  0  0
 1  0      0 16066300 1267596 7254840    0    0     0     0 3254 2032  9  0 91  0  0  0
 1  0      0 16067040 1267596 7254840    0    0     0     0 3365 1970  9  0 91  0  0  0
 1  0      0 16070556 1267604 7254840    0    0     0   250 3314 1939  9  0 91  0  0  0
 1  0      0 17049944 1267604 7254840    0    0     0     0 3079 2396  5  1 94  0  0  0
==
 0  0      0 17063576 1267628 7254840    0    0     0   718 1905 2114  0  0 99  0  0  0
 0  0      0 17075520 1267628 7254840    0    0     0    20 1638 1609  0  0 99  0  0  0
 0  0      0 17085596 1267628 7254840    0    0     0     0 1611 1543  0  0 99  0  0  0
 0  0      0 17092468 1267636 7254840    0    0     0    42 1660 1616  0  0 99  0  0  0
```

When run `mem 1024`, this takes 1GiB of memory: see `free` is only 16GiB instead of 17GiB when we not run it. In this case, it does no swap

# 3.

```
❯ ./mem 25000
allocating 26214400000 bytes (25000.00 MB)
  number of integers in array: 6553600000
loop 0 in 10634.74 ms (bandwidth: 2350.79 MB/s)
loop 1 in 3774.81 ms (bandwidth: 6622.84 MB/s)
loop 2 in 1671.86 ms (bandwidth: 14953.40 MB/s)
loop 3 in 1688.72 ms (bandwidth: 14804.11 MB/s)
loop 4 in 1650.51 ms (bandwidth: 15146.79 MB/s)
loop 5 in 1668.82 ms (bandwidth: 14980.65 MB/s)
^C
```

```
❯ vmstat 1 -w
--procs-- -----------------------memory---------------------- ---swap-- -----io---- -system-- ----------cpu----------
   r    b         swpd         free         buff        cache   si   so    bi    bo   in   cs  us  sy  id  wa  st  gu
   5    0          768     20764896       694496      4563724    0    0   196   127 1424    3   1   0  98   0   0   0
   1    0          768     20761104       694592      4563636    0    0     0   492 2913 3016   0   0  99   0   0   0
   0    0          768     20760852       694876      4563732    0    0   280  8228 2459 1793   2   1  97   0   0   0
   0    0          768     20763184       694876      4563732    0    0     0     0 1651 1437   0   0  99   0   0   0
   0    0          768     20762044       694876      4563732    0    0     0    12 2391 2392   0   0  99   0   0   0
   1    0          768     20627288       694876      4563732    0    0     8     0 2696 2526   1   1  99   0   0   0
   1    0          768     18248736       694884      4562280    0    0     0   980 3277 1729   3   6  91   0   0   0
   1    0          768     15401800       694884      4562280    0    0     0    24 3249 1509   3   6  91   0   0   0
   1    0          768     12555532       694912      4562740    0    0   488   100 5183 3512   3   6  90   0   0   0
   1    0          768      9702248       694912      4562744    0    0     0    44 3241 1451   3   6  91   0   0   0
   1    0          768      6860412       694912      4562744    0    0     0     0 3451 1456   3   6  91   0   0   0
   1    0          768      4015052       694912      4562744    0    0     0     0 3064 1425   3   6  91   0   0   0
   1    0          768      1272172       694920      4562736    0    0     0   164 3145 1400   3   6  91   0   0   0
   2    0        13568       399840       518372      3351960    0 12552     0 13016 45593 2070   2  11  87   0   0   0
   2    0       123132       383268       131132      2160764   44 104944   820 105808 262233 2224   2  15  83   0   0   0
   2    0       852716       384108        50644      1496872  764 679724  2768 679724 1242660 3219   2  15  82   1   0   0
   1    0      1613840       621468        28036      1310212 5800 667520 29156 667520 1233481 6865   5  12  81   2   0   0
   1    0      1613840       606912        28048      1310276   48    0   132     0 6634 1482   9   2  90   0   0   0
   1    0      1613576       565296        28980      1333060 1572    0 25596   108 7479 7471   9   1  89   1   0   0
   1    0      1613564       559752        28980      1333708  152    0   360     0 3188 1614   9   0  91   0   0   0
   1    0      1613560       559248        28980      1334968  672    0  1932     0 3182 1716   9   0  91   0   0   0
   1    0      1613536       557592        28980      1334968  292    0   292     0 2922 1522   9   0  91   0   0   0
   1    0      1613456       553684        28984      1335548  224    0   812     0 3494 2597   9   0  91   0   0   0
   1    0      1612828       515692        31492      1356660 4268    0 28092    40 6945 5267  12   1  86   1   0   0
--procs-- -----------------------memory---------------------- ---swap-- -----io---- -system-- ----------cpu----------
   r    b         swpd         free         buff        cache   si   so    bi    bo   in   cs  us  sy  id  wa  st  gu
   1    0      1612828       512920        31500      1356920  492    0   492   104 2849 1509   9   0  91   0   0   0
   3    0      1612820       516448        31500      1357368   80    0   524     0 3056 1598   9   0  91   0   0   0
   1    0      1611628       471944        31656      1388588 13812    0 39241     0 11072 10099  10   1  86   3   0   0
```

It swap out disk very quickly because OS want quickly find space for new coming process but take long to swapin because those data might partly are belong to the local system, OS see if which one we need using now

Loop 0 takes 10s to allocate that much amount of memory (25GiB) but subsequent loops are much faster because they might be valid in TLBs

# 4.

`System time, block output, block input` increase

`block output (bi)` still keep being high because as we said, OS is still figuring out which process to swap in
